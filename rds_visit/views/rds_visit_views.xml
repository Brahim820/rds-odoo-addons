<?xml version="1.0" encoding="utf-8"?> 
<odoo> 

<act_window 
  id="visit_action" 
  name="Visits" 
  res_model="rds.visit"
  context="{'search_default_group_by_state' : True, 'search_default_active': True}"
  />

<!-- Top menu item -->
<menuitem
    id="menu_visit_root"
    name="Gestione Visite"
    groups="rds_visit.group_visit_user,rds_visit.group_visit_manager"
    web_icon="rds_visit,static/description/icon.png"
    sequence="75"/>

<menuitem
    id="menu_visit_main"
    name="Cartellini Visite"
    action="visit_action" 
    parent="menu_visit_root"
    sequence="0"/>

<record id="visit_view_form" model="ir.ui.view"> 
  <field name="name">rds.visit.form</field> 
  <field name="model">rds.visit</field> 
  <field name="arch" type="xml"> 
    <form string="Visite">
      <header>
        <button name="action_cancel" states="draft,confirm" type="object" string="Annulla"/>
        <button name="action_askconfirm" states="draft" type="object" string="Chiedi Autorizzazione"/>
        <button name="action_confirm" states="draft" type="object" string="Autorizza" class="btn-primary" groups="rds_visit.group_visit_manager"/>
        <button name="action_start" states="confirm,done" type="object" string="Check-In" class="btn-primary"/>
        <button name="action_done" states="start" type="object" string="Check-Out" class="btn-primary"/>
        <field name="state" statusbar_visible="draft,confirm,start,done" widget="statusbar"/>
      </header>
      <sheet>
        <div class="oe_button_box" name="button_box">
          <button name="%(rds_visit_print_badge)d" states="confirm,start,done" type="action" string="Stampa Badge" icon="fa-print" class="oe_stat_button"/>  
        </div>
        <div class="oe_title">
            <label for="name" class="oe_edit_only"/>
            <h1>
                <field name="name" placeholder="Riepilogo Causale" required="True"/>
            </h1>
        </div>
        <group>
          <group> 
            <field name="visitor_contact"  domain="[('is_company', '=', False)]"/>
            <field name="visitor"/>
            <field name="visitor_company"/>
            <br/>
            <field name="conductor"/>
            <field name="is_unaccompained"/>
          </group> 
          <group> 
            <field name="date_in"/>
            <field name="date_out"/>
            <br/>
            <field name="ciwo" widget="float_time"/>
            <field name="cowi" widget="float_time"/>
          </group>
        </group>
        <field name="notes" placeholder="Altre informazioni ..." colspan="4"/>
      </sheet>
        <div class="oe_chatter">
            <field name="message_follower_ids" widget="mail_followers"/>
            <field name="activity_ids" widget="mail_activity"/>
            <field name="message_ids" widget="mail_thread"/>
        </div>
    </form> 
  </field> 
</record>

<record id="visit_view_tree" model="ir.ui.view"> 
  <field name="name">rds.visit.list</field> 
  <field name="model">rds.visit</field> 
  <field name="arch" type="xml"> 
    <tree decoration-muted="(state == 'cancel') or (state == 'expired')" decoration-info="state == 'start'" decoration-success="(state == 'confirm') or (state == 'done')">
      <field name="name"/>
      <field name="state"/>
      <field name="visitor"/>
      <field name="date_in"/>
      <field name="date_out"/>
      <field name="conductor"/>
    </tree> 
  </field> 
</record>

<record id="visit_view_search" model="ir.ui.view">
  <field name="name">rds.visit.search</field>
  <field name="model">rds.visit</field>
  <field name="arch" type="xml">
    <search string="Visite">
      <field name="visitor"/>
      <field name="date_in"/>
      <filter string="Attivi" domain="[('state','not in',['cancel', 'expired'])]" name="active"/>
      <filter string="In Azienda" domain="[('state','=','start')]" name="checkin"/>
      <filter string="Bozza" domain="[('state','=','draft')]" name="draft"/>
            <group expand="0" string="Group By">
                <filter name="group_by_state" string="State" context="{'group_by':'state'}"/>
            </group>
        </search>
    </field>
</record>

<record id="action_approve_all" model="ir.actions.server">
  <field name="name">Approva Tutte</field>
  <field name="model_id" ref="model_rds_visit"/>
  <field name="binding_model_id" ref="rds_visit.model_rds_visit"/>
  <field name="state">code</field>
  <field name="code">
    records.action_confirm()
  </field>
</record>

<record id="action_deny_all" model="ir.actions.server">
  <field name="name">Cancella Tutte</field>
  <field name="model_id" ref="model_rds_visit"/>
  <field name="binding_model_id" ref="rds_visit.model_rds_visit"/>
  <field name="state">code</field>
  <field name="code">
    records.action_cancel()
  </field>
</record>

</odoo> 